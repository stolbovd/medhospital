<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:axon="http://www.axonframework.org/schema/core"
       xmlns:ctx="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.axonframework.org/schema/core http://www.axonframework.org/schema/axon-core.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <axon:annotation-config/>
    <ctx:component-scan base-package="ua.com.alus.medhosp.backend"/>
    <axon:event-bus id="eventBus"/>
    <axon:jpa-event-store id="eventStore"/>
    <axon:command-bus id="commandBus">
        <axon:interceptors>
            <bean class="org.axonframework.commandhandling.interceptors.SpringTransactionalInterceptor">
                <property name="transactionManager" ref="transactionManager"/>
            </bean>
        </axon:interceptors>
    </axon:command-bus>

    <axon:event-sourcing-repository id="patientRepository"
                                    aggregate-type="ua.com.alus.medhosp.backend.axon.api.patient.PatientAggregate"/>

    <bean id="patientCommandHandler"
          class="ua.com.alus.medhosp.backend.axon.api.patient.handlers.PatientCommandHandler">
        <property name="repository" ref="patientRepository"/>
    </bean>
    <bean id="patientEventHandler" class="ua.com.alus.medhosp.backend.axon.api.patient.handlers.PatientEventHandler">
        <property name="patientService" ref="patientService"/>
    </bean>

    <bean id="commandProcessor" class="ua.com.alus.medhosp.backend.processor.CommandProcessorImpl">
        <property name="commandBus" ref="commandBus"/>
        <property name="command2Class">
            <map>
                <entry key="SavePatientCommand"
                       value="ua.com.alus.medhosp.backend.axon.api.patient.command.SavePatientCommand"/>
                <entry key="RemovePatientCommand"
                       value="ua.com.alus.medhosp.backend.axon.api.patient.command.RemovePatientCommand"/>
            </map>
        </property>
    </bean>

</beans>